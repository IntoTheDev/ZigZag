using ToolBox.Pools;using UnityEngine;using Random = UnityEngine.Random;public class PathGenerator : MonoBehaviour{    [SerializeField] private GameObject _floorPrefab = null;    [SerializeField] private GameObject _crystalPrefab = null;    [SerializeField] private Transform _start = null;    [SerializeField] private float _crystalSpawnProbability = 0.2f;    private Transform _spawnTo = null;    private Vector3 _crystalSpawnOffset = default;    private Camera _camera = null;    private void Awake()    {        _floorPrefab.Populate(100);        _crystalPrefab.Populate(50);        _spawnTo = _start;        _crystalSpawnOffset.y = _floorPrefab.GetComponentInChildren<MeshRenderer>().bounds.extents.y +                                _crystalPrefab.GetComponent<MeshRenderer>().bounds.extents.y;        _camera = Camera.main;        Generate(Vector3.right);        for (int i = 0; i < 50; i++)            Generate();    }    private void OnEnable() =>        UserInput.OnPress += Enable;    private void Enable()    {        InvokeRepeating(nameof(Generate), 0f, 0.1f);        UserInput.OnPress -= Enable;    }    private void Generate() =>        Generate(Random.value <= 0.5f ? Vector3.forward : Vector3.right);    private void Generate(Vector3 direction)    {        var oldPosition = _spawnTo.position;        var position = oldPosition + direction;        var viewportPosition = _camera.WorldToViewportPoint(position);        if (viewportPosition.x < 0.05f ||            viewportPosition.x > 0.95f)        {            direction = direction == Vector3.right ? Vector3.forward : Vector3.right;            position = oldPosition + direction;        }                _spawnTo = _floorPrefab.Get(position, Quaternion.identity).transform;        if (Random.value <= _crystalSpawnProbability)            _crystalPrefab.Get(_spawnTo.position + _crystalSpawnOffset, Quaternion.identity, _spawnTo);    }}